# 数据分析
## 业务题
### **费米估算问题**
1. 总体原则：自上而下拆解，自下而上计算。
2. 涉及分析方法：逻辑树分析、多维度拆解分析。
3. 目标：估算结果上下浮动范围不超过10倍即可
- **确认估算对象**：确认是否需要细化对象or转化对象
1. 估算一个**星巴克门店的销售额**：根据二八法则，星巴克的销售产品主要以饮品为主，而饮品主要以咖啡为主，因此估算对象确定为**咖啡的销售额**
2. 估算**芝加哥有多少名钢琴调音师**：将芝加哥的钢琴调音师数量转换为->**芝加哥每年需要调音的钢琴数量 / 每个调音师每年能调多少台钢琴**
```
二八法则：
    在任何一组东西中，最重要的只占其中一小部分，约20%，其余80%尽管是多数，但确是次要的。80/20法则是不受人为直接控制的，它是自然而然形成的。
```

- **拆解估算对象**
1. **需求维度**：
<br>需求值 =市场总需求规模 = 需求单位数 × 单位需求量 × 单位需求频次
<br>需求单位数 = 需求人群 × 人群转化率
```
eg：估算北京市一日卖出的油条数量。

需求单位数 = 北京市吃油条的人数 = 需求人群 × 人群转化率 = 北京市人口 × 选择吃油条的比例 = 约2000万人 × 约5% ≈ 100 万人

需求值 = 北京市一日卖出的油条数量 =需求单位数 × 单位需求量 × 单位需求频次 = 北京市吃油条的人数 × 每次吃几根 × 一天吃几次 = 100万人 × 1根/次 × 每天只早餐吃1次 ≈ 100万根油条
```
2. **供给维度**
<br>供给值 = 市场总供给能力 = 供给单位数 × 单位供给量 × 供给时段
<br>供给单位数 = 市场总区域 / 单位平均辐射区域
```
eg：估算北京市一日卖出的油条数量。

供给单位数 = 北京油条店的数目 = 市场总区域 / 单位平均辐射区域 = 北京市面积 / (五环内每1平方千米有2家油条店，五环外每2平方千米有1家油条店) = 约735万平方千米*2 + 约15700平方千米 / 2 ≈ 9320家店

供给时段 = SUM(不同时段时间) = 1天

供给值 = 北京市一日卖出的油条数量 = 供给单位数 × 单位供给量 × 供给时间 = 9320家店 × 100根/天 × 1天 ≈ 93.2万根油条
```

- **对比估算结果**
1. 供需是会**动态平衡**的，因此若需求层和供给层算出的估计值相差在**合理范围**内（不要差得太离谱就可以），则可以得出一个大致的估计值or估计范围
```
北京市一日卖出的油条数量大约在93.2万~100万根油条（or大约96.5万根）
```
2. 若相差太离谱，可能需要重新考虑上述计算的过程，或者直接进入下一环节

- **关注可能的误差**
1. 最后需要列出可能出现误差的**影响因素**
```
比如：需求人群可以再进一步细分、供给单位的平均辐射区域大小有待考证……
```
2. 可以根据实际情况给出一些未来的**改进办法**
```
比如：抽样调查、观测历史数据……
```

### **A/B测试**
+ 涉及分析方法：对比分析、假设检验分析、群组（同期群）分析
- 定义
```
A/B test，又称分组隔离实验，简单来讲，A/B测试是一种比较手段：通过分析同一总体下，由于某些不同的策略导致样本数据表现出的差异，来推断某些策略的效果
```
1. 理解：为了同一个目标，制定多个方案并行测试，每个方案只有1个变量不同。让相似的用户群组使用各个不同的方案，收集每种方案的数据后，以某种规则选出最优方案
2. 本质：假设检验的一种实际应用（控制变量）

- 应用场景
1. 产品迭代：如界面优化（改字体、增弹窗等）、功能增加、流程增加……
2. 策略优化：如算法策略、运营策略、营销策略……
3. 作用：科学量化各个方案的效果（如ROI<投资回报率>等），衡量决策收益，避免拍脑袋决定
```
不适用的场景：
1. 用户体验的制约（如价格调整）
2. 样本数量制约（如防止侵害的安全类事件）
3. AB组间存在干扰（如滴滴司机间有司机群）
```

- 科学依据
```
科学的实验设计；
1. 科学的采样（随机化）
2. 科学的流量分割（正交与互斥）
   A/B测试从应用到系统搭建：https://zhuanlan.zhihu.com/p/79690021
   AB测试案例拆解-流量分配：https://zhuanlan.zhihu.com/p/359586351
3. 科学的统计学原理（假设检验）
   假设检验：https://www.zhihu.com/tardis/zm/art/86178674?source_id=1005
   power：https://blog.csdn.net/weixin_46719623/article/details/120931568
   ps：大/小样本 -> z/t 分布
```
双边检验：
$$
Power = \Phi(\frac{\mu_x-\mu_y}{\sqrt{s_x^2/n_x+s_y^2/n_y}}-Z_{1-\alpha/2})=1-\beta
$$
$$
if\ n_x=n_y=n,\ then\ n=\frac{(Z_{1-\alpha/2}+Z_{1-\beta})^2*(s_x^2+s_y^2)}{(\mu_x-\mu_y)^2}
$$

- 步骤
1. **分析现状，提出假设**
```
假设有A、B两个方案，想确定A、B之间是否客观存在差异，还是这种差异仅由某种误差引起。因此假定：
H0（原假设/零假设）：A、B没有本质差异
H1（备择假设）：A、B确实存在差异
```
2. **设定指标，制定方案**
```
收集了一些经验贴以及相关网站（如华为开发者联盟和字节火山引擎上的A/B测试产品）里提到的指标，然后利用用户生命周期梳理如下：
① 引入期：PV（Page View）、UV（Unique Visitor）、**点击率**；
② 成长期：转化率、互动时长（观看时长等）；
③ 成熟期：**GMV**（Gross Merchandise Volume）；
④ 休眠期 + ⑤ 流失期：留存率。
```
3. **算样本量，设计投放**
```
①样本量计算公式（通过σ和β确定）:
N为样本量；
α是第Ⅰ类错误的概率，也称显著性水平，一般取0.05；
β是第Ⅱ类错误的概率，一般取0.2，(1-β)是统计功效（power），一般而言设(1-β) ≥ 80%；
Δ是所想要指标预期的变化量（μ₁-μ₂），eg：点击率从5%上升到10%，那么Δ为5%。
σ²是指标的样本方差，如果没有可以采用最大值0.5；
```
>注意事项：如果有多个指标，则选用最大的指标所需要的样本量；计算结果是每个分组所需要的样本量，有几个分组就需要乘几；样本量可以是累积一段时间的最终样本量。

$$N = \frac{2\sigma^2(z_{1-\alpha/2}+z_{1-\beta})^2}{\Delta^2}$$
```
② 确定投放时间：
实验时间 = 实验需要样本量 / 每天产生的样本量；
另一个判断标准是：当统计显著性达到95%或以上并且维持一段时间，实验可以结束。
```
>如果统计显著性在95%以下，则可能需要延长测试时间；
如果很长时间统计显著性不能达到95%甚至90%，则需要决定是否中止试验
```
③ 实验城市的选取：
原因：有些实验可能存在负向影响，为了控制实验范围，要找部分城市做试点；也有可能每个城市的特性差异较大，全国上线时，城市之间的差异被平均化了，不能看到真实的策略效果，因此需要选择部分城市做实验。
原则：一是尽量选择大体量城市，样本充足，实验周期更短；二是要选择不同类型的城市，观察方案是否具有普适性。
```
4. 分配流量和分流时机
>首先根据实验目标和 <u>用户属性</u>（地域、活跃/流失用户……）确定实验的受众群体；然后再确定每个方案的分流比例，即确定有多少用户/多少流量给到这个实验。流量的设置可以根据情况从初始阶段开始逐渐增加流量
```
分流方法：
① 将业务逻辑互斥的环节分为多“层”，每一层都共享一批用户；
② 在每一层内将用户随机切割进不同的“桶”，一个用户只能在一个桶内；
③ 只要多层之间互不影响，就能确保每个实验都能实现全流量切割。
分流时机：
① 实验分流的触发点，是且只能是策略/方案的生效点。
② 一切目的都是为了让策略/方案之间的唯一变量是策略/方案之间效果差异的唯一来源
```
[![pCNhKXT.png](https://s1.ax1x.com/2023/06/25/pCNhKXT.png)](https://imgse.com/i/pCNhKXT)
```
从左到右，３条较粗的竖线代表了 A/B 测试中的３个关键角色：客户端（Client）、服务器（Server）、数据层（Data）。从上到下代表了３种访问形式：

无 A/B 测试的普通访问流程（Non AB test）

基于后端分流的 A/B 测试访问流程（Back-end AB test）
   传统的A/B测试方式。当用户的请求到达服务器时，服务器根据一定的规则，给不同的用户返回不同的版本，同时记录数据的工作也在服务端完成。基于后端的 A/B 测试技术实现上稍微简单一些，不过缺点是收集到的数据通常是比较宏观的PV（Page View）信息。

基于前端分流的 A/B 测试访问流程（Front-end AB test）
   可以比较精确地记录下用户在页面上的每一个行为。它的特点是，利用前端 JavaScript 方法，在客户端进行分流，同时，可以用 JavaScript 记录下用户的鼠标行为（甚至键盘行为，如果需要的话），直接发送到服务器记录。
```